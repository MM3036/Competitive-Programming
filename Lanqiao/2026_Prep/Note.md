# ç®—æ³•ç¬”è®°ï¼šä»â€œç›´è§‰æ€ç»´â€åˆ°â€œè´¡çŒ®æ³•â€çš„æ€ç»´è·ƒè¿

**æ—¥æœŸï¼š** 2026-01-12  
**æ ‡ç­¾ï¼š** #Lanqiao #Python #ContributionMethod #Optimization

## 1. æ ¸å¿ƒæ€ç»´å¯¹æ¯”

åœ¨è§£å†³â€œç»Ÿè®¡çŸ©é˜µ/æ•°ç»„ä¸­æ»¡è¶³æ¡ä»¶çš„å¯¹æ•°â€è¿™ç±»é—®é¢˜æ—¶ï¼Œæˆ‘ç»å†äº†ä» **Code A (ç›´è§‰æ³•)** åˆ° **Code B (è´¡çŒ®æ³•)** çš„è®¤çŸ¥å‡çº§ã€‚

### ğŸ”´ Phase 1: æ•´ä½“åˆ†æ­¥å¤„ç†æ€ç»´ (Code A)
* **ç›´è§‰é€»è¾‘ï¼š** å…ˆ**å°†æ•°æ®è¿›è¡Œåˆ†ç±»æ•´ç†**ï¼Œæ•´ç†å®Œåå†å»ç»Ÿè®¡ä¸ªæ•°ï¼Œæœ€åå†è®¡ç®—**æ’åˆ—ç»„åˆ**çš„ç»“æœã€‚
* **åšæ³•ï¼š** `Read all data` -> `Store in List` -> `Group by Diag` -> `Calculate Combinations`.
* **è‡´å‘½å¼±ç‚¹ï¼š**
    * **ç©ºé—´çˆ†ç‚¸ï¼š** éœ€è¦å­˜å‚¨ $N \times M$ ä¸ªæ•´æ•°ï¼Œæ•°æ®é‡å¤§æ—¶ç›´æ¥ **MLE (å†…å­˜è¶…é™)**ã€‚
    * **æ•ˆç‡ä½ä¸‹ï¼š** éœ€è¦å¤šæ¬¡éå†æ•°æ®ï¼Œç”šè‡³éœ€è¦äºŒæ¬¡å¾ªç¯ç»Ÿè®¡ã€‚

### ğŸŸ¢ Phase 2: æµå¼æ€ç»´â€”â€”è®¡ç®—æœºå¤„ç†çš„æ–¹å¼ (Code B)
* **è¿›é˜¶é€»è¾‘ï¼š** **è®¡ç®—å¢é‡**è€Œä¸æ˜¯å¤„ç†å…¨ä½“æ•°æ®ã€‚è®©æ•°æ®ä¸€ä¸ªä¸€ä¸ªè¿›æ¥ï¼Œ**æ¯è¿›æ¥ä¸€ä¸ªï¼Œå°±ç®—ä¸€æ¬¡è¯¥æ•°æ®çš„åŠ å…¥ä¼šå‡ºç°å¤šå°‘æ–°çš„æ­£ç¡®ç»“æœ**ï¼Œç„¶åç´¯åŠ ã€‚å³**â€œæµå¼å¤„ç†ï¼Œå³æ—¶ç»“ç®—â€**ã€‚
* **åšæ³•ï¼š** `Stream Input` -> `Calculate Contribution` -> `Update State`.
* **æ ¸å¿ƒä¼˜åŠ¿ï¼š**
    * **æè‡´çœæµï¼š** å†…å­˜é‡Œæ°¸è¿œåªå­˜â€œè®¡æ•°å™¨â€ï¼Œä¸å­˜åŸå§‹æ•°æ®ã€‚
    * **ä¸€æ¬¡æˆå‹ï¼š** æ•°æ®åªè¿‡æ‰‹ä¸€æ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦ä¼˜åŒ–è‡³ $O(N \times M)$ (çº¿æ€§æ‰«æ)ã€‚

---

## 2. å…³é”®æŠ€æœ¯ç‚¹è§£æ

### A. è´¡çŒ®æ³• (Contribution Technique)
ä¸ç­‰åˆ°æœ€åç®— $C_n^2$ï¼Œè€Œæ˜¯åˆ©ç”¨ç­‰å·®æ•°åˆ—æ€§è´¨ï¼Œåœ¨å¾ªç¯ä¸­ç´¯åŠ ã€‚
* **å…¬å¼ï¼š** `ans += count[key]`
* **å«ä¹‰ï¼š** å½“å‰è¿™ä¸ªæ–°æ¥çš„æ•°å­—ï¼Œèƒ½å’Œå‰é¢å·²ç»å‡ºç°çš„ `count` ä¸ªæ•°å­—ç»„æˆ `count` ä¸ªå¯¹å­ã€‚

### B. è¿­ä»£å™¨ (Iterator)
* **ä»£ç ï¼š** `input_iter = map(int, sys.stdin.read().split())`
* **åŸç†ï¼š** åˆ›å»ºä¸€ä¸ªâ€œä¼ é€å¸¦â€ï¼Œç”¨ `next(input_iter)` æŒ‰éœ€å–æ•°ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§æŠŠ 100 ä¸‡ä¸ªæ•°è¯»è¿›å†…å­˜ã€‚è¿™æ˜¯ Python ç«èµ›ä¼˜åŒ–çš„å…³é”®ã€‚

### C. åæ ‡é™ç»´ (Coordinate Compression)
å°†äºŒç»´çŸ©é˜µåæ ‡ $(r, c)$ æ˜ å°„ä¸ºä¸€ç»´ç´¢å¼• $i$ï¼Œå®ç°å•å±‚å¾ªç¯éå†ã€‚
* **è¡Œå·ï¼š** `r = i // m` (è¢« $m$ é™¤ä¹Ÿå°±æ˜¯è¢«æŒ¤åˆ°äº†ç¬¬å‡ è¡Œ)
* **åˆ—å·ï¼š** `c = i % m` (åœ¨å½“å‰è¡Œæ’ç¬¬å‡ ä¸ª)
* **åº”ç”¨ï¼š** é…åˆå…ƒç»„ Key `(r - c, val)` ä½¿ç”¨ï¼Œç²¾å‡†å®šä½â€œåŒä¸€å¯¹è§’çº¿ä¸”æ•°å€¼ç›¸åŒâ€çš„å…ƒç´ ã€‚

> **ğŸ’¡ ä¼˜åŒ–å¿ƒå¾—ï¼š** > åœ¨å¤„ç†äºŒç»´åˆ—è¡¨æ—¶ï¼Œå¦‚æœé€»è¾‘ä¸Šä¸éœ€è¦æ˜¾å¼çš„ $(r,c)$ åæ ‡ï¼Œ**ä¸€å®šä¸è¦ç”¨åŒå±‚ for å¾ªç¯**ã€‚è™½ç„¶ `range` åº•å±‚æ˜¯ C è¯­è¨€å®ç°çš„ï¼Œä½†åœ¨ Python ä¸­ï¼ŒåŒå±‚å¾ªç¯å¸¦æ¥çš„è§£é‡Šå™¨å¼€é”€å’Œä»£ç ç¼©è¿›å¤æ‚åº¦ï¼Œè¿œä¸å¦‚**ä¸€ç»´æ‰“å¹³**åå¤„ç†æ¥å¾—é«˜æ•ˆç®€æ´ã€‚

---

## 3. æé€Ÿä»£ç æ¨¡æ¿ (Python)

```python
import sys
from collections import defaultdict

# 1. æé€Ÿæµå¼è¯»å…¥
input_iter = map(int, sys.stdin.read().split())

try:
    n = next(input_iter)
    m = next(input_iter)
    
    # 2. è®¡æ•°å™¨ (Defaultdict çœå»åˆå§‹åŒ–åˆ¤æ–­)
    cnt = defaultdict(int)
    ans = 0
    
    # 3. å•å±‚å¾ªç¯ (é…åˆåæ ‡å˜æ¢)
    for i in range(n * m):
        val = next(input_iter)
        
        # æ ¸å¿ƒï¼šå®šä¹‰ä½ çš„â€œè€ä¹¡â€æ˜¯è°
        # ä¾‹å¦‚ï¼šä¸»å¯¹è§’çº¿ r-c ç›¸åŒï¼Œä¸”æ•°å€¼ val ç›¸åŒ
        key = ((i // m) - (i % m), val)
        
        # 4. è´¡çŒ®æ³•ï¼šå…ˆåŠ ç­”æ¡ˆï¼Œåæ›´æ–°è®¡æ•°
        # è¿™é‡Œçš„æ€æƒ³æ˜¯ï¼šå‰é¢çš„ k ä¸ªè€ä¹¡ï¼Œæ¯ä¸ªäººéƒ½èƒ½å’Œæˆ‘æ¡ä¸€æ¬¡æ‰‹
        ans += cnt[key]
        cnt[key] += 1
        
    print(ans)

except StopIteration:
    pass
